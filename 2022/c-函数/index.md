# C++函数


## 函数声明  
函数声明负责指定函数的名字、返回值的类型以及调用该函数所需的参数数量和类型：
```cpp
Elem* next_elem(); //无须参数，返回Elem*
void exit(int); //int类型的参数，无返回值
double sqrt(double); //double类型的参数，返回double
```

### 函数声明的组成要件  
函数声明除了指定函数的名字、一组参数以及函数的返回类型外，还包括多种限定符和修饰符：
- 函数的名字，必选
- 参数列表，可以为空，必选
- 返回类型，可以是void，可以是前置或后置形式(使用auto)，必选
- inline，表示一种愿望，通过内联函数体实现函数调用 
- constexpr，表示当给定常量表达式作为实参时，应该可以在编译时对函数求值  
- noexcept，表示该函数不允许抛出异常
- 链接说明，例如static
- [[noreturn]]，表示该函数不会用常规的调用/返回机制返回结果

此外，成员函数还能被限定为：
- virtual，表示该函数可以被派生类覆盖 
- override，表示该函数必须覆盖基类中的一个虚函数
- final，表示该函数不能被派生类覆盖
- static，表示函数不与某一特定的对象关联
- const，表示该函数不能修改其对象的内容  


### 函数定义  
函数的定义和全部声明必须对应同一类型。不过，为了与C语言兼容，会自动忽略参数类型的顶层const，下面两条声明语句对应的是同一个函数：
```cpp
void f(int); //类型是void(int)
void f(const int); //类型是void(int)
```
函数f()可以定义成：
```cpp
void f(int x); //允许在此处修改x
```
或者定义成
```cpp
void f(const int x); //不允许在此处修改x
```
不论对哪种情况而言，都只是函数调用者提供的实参的一个副本。  
通常通过不命名某个参数来表示该参数未在函数定义中使用：
```cpp
void search(table* t, const char* key, const char*){
    //未用到第三个参数
}
```
一般来说，未命名的参数有助于简化代码并提升代码的可扩展性。  
除了函数之外，还能调用其他一些东西，它们遵循函数的大多数规则，比如参数传递规则：  
- 构造函数：严格来说不是函数，它没有返回值，可以初始化基类和成员，无法得到其地址。
- 析构函数：不能被重载，无法得到其地址。
- 函数对象：不是函数，不能被重载，但是其operaotr()是函数。
- lambda表达式：是定义函数对象的一种简写形式。  

### 返回值  
传统上，返回类型位于函数声明语句一开始的地方。然而，也可以在函数声明中把返回类型写在参数列表之后：
```cpp
string to_string(int a);
auto to_string(int a)->string;
```
前置的auto关键字表示函数的返回类型放在参数列表之后。后置返回类型则由符号->引导。 
后置返回类型的必要性源于函数模板声明，因为其返回类型是依赖于参数的：
```cpp
template<class T,class U>
auto product(const vector<T>& x,const vector<U>& y) -> decltype(x*y);
```
函数如果调用了它自身，称之为递归。
函数可以包含多条reutrn语句：
```cpp
int fac2(int n)
{
    if(n > 1)
        return n*fac2(n-1);
    return 1;
}
```
与参数传递的语义类似，函数返回值的语义也与拷贝初始化的语义一致。return语句初始化一个返回类型的变量，编译器检查返回表达式的类型是否与函数的返回类型吻合，并在必要时执行标准的或者用户自定义的类型转换：
```cpp
double f(){return 1;}
```
每次调用函数时，重新分配它的实参以及局部变量的拷贝。一旦函数返回了结果，所占的存储空间就被重新分配了。因此，不应该返回指向局部而非static变量的指针，我们无法预计该指针所指位置的内容将发生什么样的改变：
```cpp
int* fp()
{
    int local = 1;
    return &local;
}
```
引用有时也会发生类似的错误：
```cpp
int& fr()
{
    int local = 1;
    return local;
}
```
并不存在void值，不过，可以调用void函数令其作为另一个void函数的返回值：
```cpp
void g(int* p);
void h(int* p)
{
    return g(p); //OK，等价与“g(p)；return；”
}
```
当编写模板函数返回类型是模板参数时，这种返回类型有助于避免某些特殊情况。  
return语句的形式属于下述5种之一：
- 执行一条return语句。
- “跳转到函数末尾”，也就是说，直接到达函数体末端。这种情况只允许出现在无返回值的函数中。 
- 抛出一个未被局部捕获的异常。 
- 在一个noexcept函数中抛出一个异常且没有局部捕获，造成程序终止。
- 直接或间接请求一个无返回值的系统函数。



